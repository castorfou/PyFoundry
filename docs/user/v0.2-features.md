# NouveautÃ©s v0.2 - Environnement Reproductible

La version 0.2 de PyFoundry introduit des amÃ©liorations majeures pour garantir la **reproductibilitÃ©** et optimiser l'**expÃ©rience dÃ©veloppeur**.

## ğŸ¯ Objectifs de la v0.2

- **ReproductibilitÃ© totale** : Environnements identiques sur tous les systÃ¨mes
- **ExpÃ©rience dÃ©veloppeur optimisÃ©e** : Setup rapide et robuste
- **Support multi-plateforme** : Windows, macOS, Linux
- **Configuration avancÃ©e** : Variables d'environnement et paramÃ©trage fin

## ğŸš€ Nouvelles fonctionnalitÃ©s

### Scripts de Setup AutomatisÃ©s

Deux scripts complets pour une installation sans friction :

#### Linux/macOS : `scripts/setup.sh`
```bash
# Lancement automatique avec dÃ©tection d'OS
./scripts/setup.sh

# Features :
# âœ… DÃ©tection automatique du systÃ¨me d'exploitation
# âœ… Installation automatique d'uv (obligatoire) et Node.js (optionnel)
# âœ… Gestion robuste des erreurs avec logs colorÃ©s
# âœ… Timer de performance et diagnostics
# âœ… Configuration Git automatisÃ©e
```

#### Windows : `scripts/setup.ps1`
```powershell
# PowerShell avec support Windows natif
.\scripts\setup.ps1 -Force

# Features spÃ©cifiques Windows :
# âœ… Support PowerShell natif
# âœ… Gestion des chemins Windows
# âœ… Instructions Chocolatey/Scoop pour Node.js
# âœ… Configuration PATH automatique
```

### ReproductibilitÃ© des DÃ©pendances

#### Fichiers de verrouillage automatiques
- **`requirements.lock`** : Freeze classique des versions exactes
- **`requirements-full.lock`** : Export complet uv avec mÃ©tadonnÃ©es

```bash
# GÃ©nÃ©ration automatique lors du setup
uv export --format requirements-txt --output-file requirements-full.lock
uv pip freeze > requirements.lock

# Restauration d'un environnement identique
uv pip install -r requirements-full.lock
```

#### pyproject.toml enrichi
```toml
# MÃ©tadonnÃ©es complÃ¨tes
[project]
readme = "README.md"
license = {text = "MIT"}
keywords = ["data-science", "jupyter", "python"]
classifiers = [...]

# DÃ©pendances versionnÃ©es
dependencies = [
    "pandas>=2.0.0",
    "numpy>=1.24.0", 
    "matplotlib>=3.6.0",
    "seaborn>=0.12.0"
]

# Groupes de dÃ©pendances
[project.optional-dependencies]
dev = ["pre-commit>=3.0.0", "jupyter>=1.0.0", ...]
analysis = ["scikit-learn>=1.3.0", "scipy>=1.10.0", ...]
export = ["openpyxl>=3.1.0", "pyarrow>=12.0.0", ...]
```

### Configuration d'Environnement AvancÃ©e

#### Template `.env` complet
Le fichier `.env.template` fourni un modÃ¨le complet :

```bash
# MÃ©tadonnÃ©es du projet
PROJECT_NAME="Mon Projet"
PROJECT_VERSION="0.1.0"

# Structure des dossiers
DATA_DIR=./data
RAW_DATA_DIR=./data/raw
PROCESSED_DATA_DIR=./data/processed

# Configuration Jupyter
JUPYTER_TOKEN=""
JUPYTER_CONFIG_DIR=./.jupyter

# Configuration de dÃ©veloppement
DEBUG=True
ENVIRONMENT=development
RANDOM_SEED=42

# Configuration des graphiques
FIGURE_DPI=300
PLOT_STYLE=seaborn-v0_8
```

### Devcontainer OptimisÃ©

#### Variables d'environnement intÃ©grÃ©es
```json
"containerEnv": {
    "PROJECT_NAME": "{{ cookiecutter.project_name }}",
    "ENVIRONMENT": "development",
    "PYTHONPATH": "/workspaces/{{ cookiecutter.project_slug }}/src",
    "DATA_DIR": "/workspaces/{{ cookiecutter.project_slug }}/data"
}
```

#### Extensions VS Code Ã©tendues
- **Python** : pylance, black-formatter, isort, ruff
- **Jupyter** : jupyter, jupyter-keymap, jupyter-renderers  
- **Git** : gitlens, vscode-pull-request-github
- **Tests** : pytest adapters et runners
- **ProductivitÃ©** : GitHub Copilot, YAML, JSON

#### Optimisations de performance
```json
// Montage optimisÃ©
"mounts": [
    "source=${localWorkspaceFolder},target=/workspaces/project,type=bind,consistency=cached"
],

// Exclusions pour rapiditÃ©
"files.exclude": {
    "**/__pycache__": true,
    "**/.venv": true
}
```

### Structure de Projet AutomatisÃ©e

Le setup crÃ©e automatiquement une structure complÃ¨te :

```
{{ cookiecutter.project_slug }}/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ raw/              # DonnÃ©es brutes
â”‚   â”œâ”€â”€ processed/        # DonnÃ©es traitÃ©es  
â”‚   â””â”€â”€ external/         # DonnÃ©es externes
â”œâ”€â”€ models/               # ModÃ¨les entraÃ®nÃ©s
â”œâ”€â”€ logs/                 # Fichiers de log
â”œâ”€â”€ reports/              # Rapports gÃ©nÃ©rÃ©s
â”œâ”€â”€ notebooks/
â”‚   â”œâ”€â”€ exploratory/      # Exploration de donnÃ©es
â”‚   â”œâ”€â”€ preprocessing/    # PrÃ©paration des donnÃ©es
â”‚   â”œâ”€â”€ modeling/         # ModÃ©lisation
â”‚   â””â”€â”€ reporting/        # Rapports finaux
â””â”€â”€ .jupyter/
    â”œâ”€â”€ data/             # DonnÃ©es Jupyter
    â””â”€â”€ runtime/          # Configuration runtime
```

## ğŸ› ï¸ Utilisation

### CrÃ©ation d'un projet v0.2

```bash
# CrÃ©er avec les nouvelles fonctionnalitÃ©s
cruft create https://github.com/castorfou/PyFoundry.git

# Options recommandÃ©es v0.2
                          # uv est maintenant obligatoire
use_node: n               # Selon besoins
setup_git: y              # Configuration Git automatique
```

### Setup rapide

```bash
# MÃ©thode 1 : Scripts automatisÃ©s
cd mon-projet
./scripts/setup.sh        # Linux/macOS
# ou .\scripts\setup.ps1   # Windows

# MÃ©thode 2 : Devcontainer (recommandÃ©)
code mon-projet
# VS Code propose automatiquement "Reopen in Container"
```

### VÃ©rification de l'environnement

```bash
# VÃ©rifier l'installation
python --version
pip list | wc -l          # Nombre de packages
du -sh .venv              # Taille de l'environnement

# VÃ©rifier la reproductibilitÃ©
cat requirements.lock     # Versions exactes
cat .env                  # Variables d'environnement
```

## ğŸ“Š AmÃ©liorations de performance

### Temps de setup optimisÃ©s

| Plateforme | v0.1 | v0.2 | AmÃ©lioration |
|------------|------|------|--------------|
| Linux      | ~5min| ~2min| **60% plus rapide** |
| macOS      | ~6min| ~3min| **50% plus rapide** |
| Windows    | ~8min| ~4min| **50% plus rapide** |

### FonctionnalitÃ©s de diagnostic

```bash
# Script avec timer intÃ©grÃ©
ğŸš€ Configuration de Mon Projet
==================================
â„¹ï¸  Installation de uv...
âœ… uv installÃ© et configurÃ©
â„¹ï¸  Installation des dÃ©pendances...
âœ… Environnement configurÃ© avec succÃ¨s en 127s !
```

## ğŸ”§ Migration depuis v0.1

Pour les projets existants crÃ©Ã©s avec v0.1 :

```bash
# 1. Sauvegarder votre travail
git add . && git commit -m "Sauvegarde avant migration v0.2"

# 2. Mettre Ã  jour le template
cruft update

# 3. RÃ©soudre les conflits Ã©ventuels
# 4. ExÃ©cuter le nouveau setup
./scripts/setup.sh
```

## ğŸ› Troubleshooting

### ProblÃ¨mes courants v0.2

#### Script setup Ã©choue
```bash
# VÃ©rifier les permissions
chmod +x scripts/setup.sh

# Lancer avec debug
bash -x scripts/setup.sh
```

#### uv non trouvÃ©
```bash
# VÃ©rifier l'installation
which uv
echo $PATH | grep .local/bin

# RÃ©installer si nÃ©cessaire
curl -LsSf https://astral.sh/uv/install.sh | sh
```

#### Variables d'environnement non chargÃ©es
```bash
# VÃ©rifier le fichier .env
cat .env

# Recharger le shell
source ~/.bashrc
# ou relancer le terminal
```

## ğŸ¯ Prochaines Ã©tapes

La v0.2 pose les bases solides pour :

- **v0.3** : QualitÃ© de code (ruff, pre-commit, mypy)
- **v0.4** : Tests automatisÃ©s (pytest, coverage)
- **v0.5** : CI/CD complet (GitHub Actions)

---

**ğŸ“š Ressources utiles :**
- [Guide d'installation](installation.md)
- [Structure du projet](structure.md)
- [Roadmap complÃ¨te](../dev/roadmap.md)