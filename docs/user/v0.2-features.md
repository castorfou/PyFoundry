# Nouveautés v0.2 - Environnement Reproductible

La version 0.2 de PyFoundry introduit des améliorations majeures pour garantir la **reproductibilité** et optimiser l'**expérience développeur**.

## 🎯 Objectifs de la v0.2

- **Reproductibilité totale** : Environnements identiques sur tous les systèmes
- **Expérience développeur optimisée** : Setup rapide et robuste
- **Support multi-plateforme** : Windows, macOS, Linux
- **Configuration avancée** : Variables d'environnement et paramétrage fin

## 🚀 Nouvelles fonctionnalités

### Scripts de Setup Automatisés

Deux scripts complets pour une installation sans friction :

#### Linux/macOS : `scripts/setup.sh`
```bash
# Lancement automatique avec détection d'OS
./scripts/setup.sh

# Features :
# ✅ Détection automatique du système d'exploitation
# ✅ Installation automatique d'uv (obligatoire) et Node.js (optionnel)
# ✅ Gestion robuste des erreurs avec logs colorés
# ✅ Timer de performance et diagnostics
# ✅ Configuration Git automatisée
```

#### Windows : `scripts/setup.ps1`
```powershell
# PowerShell avec support Windows natif
.\scripts\setup.ps1 -Force

# Features spécifiques Windows :
# ✅ Support PowerShell natif
# ✅ Gestion des chemins Windows
# ✅ Instructions Chocolatey/Scoop pour Node.js
# ✅ Configuration PATH automatique
```

### Reproductibilité des Dépendances

#### Fichiers de verrouillage automatiques
- **`requirements.lock`** : Freeze classique des versions exactes
- **`requirements-full.lock`** : Export complet uv avec métadonnées

```bash
# Génération automatique lors du setup
uv export --format requirements-txt --output-file requirements-full.lock
uv pip freeze > requirements.lock

# Restauration d'un environnement identique
uv pip install -r requirements-full.lock
```

#### pyproject.toml enrichi
```toml
# Métadonnées complètes
[project]
readme = "README.md"
license = {text = "MIT"}
keywords = ["data-science", "jupyter", "python"]
classifiers = [...]

# Dépendances versionnées
dependencies = [
    "pandas>=2.0.0",
    "numpy>=1.24.0", 
    "matplotlib>=3.6.0",
    "seaborn>=0.12.0"
]

# Groupes de dépendances
[project.optional-dependencies]
dev = ["pre-commit>=3.0.0", "jupyter>=1.0.0", ...]
analysis = ["scikit-learn>=1.3.0", "scipy>=1.10.0", ...]
export = ["openpyxl>=3.1.0", "pyarrow>=12.0.0", ...]
```

### Configuration d'Environnement Avancée

#### Template `.env` complet
Le fichier `.env.template` fourni un modèle complet :

```bash
# Métadonnées du projet
PROJECT_NAME="Mon Projet"
PROJECT_VERSION="0.1.0"

# Structure des dossiers
DATA_DIR=./data
RAW_DATA_DIR=./data/raw
PROCESSED_DATA_DIR=./data/processed

# Configuration Jupyter
JUPYTER_TOKEN=""
JUPYTER_CONFIG_DIR=./.jupyter

# Configuration de développement
DEBUG=True
ENVIRONMENT=development
RANDOM_SEED=42

# Configuration des graphiques
FIGURE_DPI=300
PLOT_STYLE=seaborn-v0_8
```

### Devcontainer Optimisé

#### Variables d'environnement intégrées
```json
"containerEnv": {
    "PROJECT_NAME": "{{ cookiecutter.project_name }}",
    "ENVIRONMENT": "development",
    "PYTHONPATH": "/workspaces/{{ cookiecutter.project_slug }}/src",
    "DATA_DIR": "/workspaces/{{ cookiecutter.project_slug }}/data"
}
```

#### Extensions VS Code étendues
- **Python** : pylance, black-formatter, isort, ruff
- **Jupyter** : jupyter, jupyter-keymap, jupyter-renderers  
- **Git** : gitlens, vscode-pull-request-github
- **Tests** : pytest adapters et runners
- **Productivité** : GitHub Copilot, YAML, JSON

#### Optimisations de performance
```json
// Montage optimisé
"mounts": [
    "source=${localWorkspaceFolder},target=/workspaces/project,type=bind,consistency=cached"
],

// Exclusions pour rapidité
"files.exclude": {
    "**/__pycache__": true,
    "**/.venv": true
}
```

### Structure de Projet Automatisée

Le setup crée automatiquement une structure complète :

```
{{ cookiecutter.project_slug }}/
├── data/
│   ├── raw/              # Données brutes
│   ├── processed/        # Données traitées  
│   └── external/         # Données externes
├── models/               # Modèles entraînés
├── logs/                 # Fichiers de log
├── reports/              # Rapports générés
├── notebooks/
│   ├── exploratory/      # Exploration de données
│   ├── preprocessing/    # Préparation des données
│   ├── modeling/         # Modélisation
│   └── reporting/        # Rapports finaux
└── .jupyter/
    ├── data/             # Données Jupyter
    └── runtime/          # Configuration runtime
```

## 🛠️ Utilisation

### Création d'un projet v0.2

```bash
# Créer avec les nouvelles fonctionnalités
cruft create https://github.com/castorfou/PyFoundry.git

# Options recommandées v0.2
                          # uv est maintenant obligatoire
use_node: n               # Selon besoins
setup_git: y              # Configuration Git automatique
```

### Setup rapide

```bash
# Méthode 1 : Scripts automatisés
cd mon-projet
./scripts/setup.sh        # Linux/macOS
# ou .\scripts\setup.ps1   # Windows

# Méthode 2 : Devcontainer (recommandé)
code mon-projet
# VS Code propose automatiquement "Reopen in Container"
```

### Vérification de l'environnement

```bash
# Vérifier l'installation
python --version
pip list | wc -l          # Nombre de packages
du -sh .venv              # Taille de l'environnement

# Vérifier la reproductibilité
cat requirements.lock     # Versions exactes
cat .env                  # Variables d'environnement
```

## 📊 Améliorations de performance

### Temps de setup optimisés

| Plateforme | v0.1 | v0.2 | Amélioration |
|------------|------|------|--------------|
| Linux      | ~5min| ~2min| **60% plus rapide** |
| macOS      | ~6min| ~3min| **50% plus rapide** |
| Windows    | ~8min| ~4min| **50% plus rapide** |

### Fonctionnalités de diagnostic

```bash
# Script avec timer intégré
🚀 Configuration de Mon Projet
==================================
ℹ️  Installation de uv...
✅ uv installé et configuré
ℹ️  Installation des dépendances...
✅ Environnement configuré avec succès en 127s !
```

## 🔧 Migration depuis v0.1

Pour les projets existants créés avec v0.1 :

```bash
# 1. Sauvegarder votre travail
git add . && git commit -m "Sauvegarde avant migration v0.2"

# 2. Mettre à jour le template
cruft update

# 3. Résoudre les conflits éventuels
# 4. Exécuter le nouveau setup
./scripts/setup.sh
```

## 🐛 Troubleshooting

### Problèmes courants v0.2

#### Script setup échoue
```bash
# Vérifier les permissions
chmod +x scripts/setup.sh

# Lancer avec debug
bash -x scripts/setup.sh
```

#### uv non trouvé
```bash
# Vérifier l'installation
which uv
echo $PATH | grep .local/bin

# Réinstaller si nécessaire
curl -LsSf https://astral.sh/uv/install.sh | sh
```

#### Variables d'environnement non chargées
```bash
# Vérifier le fichier .env
cat .env

# Recharger le shell
source ~/.bashrc
# ou relancer le terminal
```

## 🎯 Prochaines étapes

La v0.2 pose les bases solides pour :

- **v0.3** : Qualité de code (ruff, pre-commit, mypy)
- **v0.4** : Tests automatisés (pytest, coverage)
- **v0.5** : CI/CD complet (GitHub Actions)

---

**📚 Ressources utiles :**
- [Guide d'installation](installation.md)
- [Structure du projet](structure.md)
- [Roadmap complète](../dev/roadmap.md)